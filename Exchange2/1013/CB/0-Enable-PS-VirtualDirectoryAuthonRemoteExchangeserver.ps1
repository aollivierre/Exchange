#run the following


Get-PowerShellVirtualDirectory | Format-List
Get-PowerShellVirtualDirectory | Set-PowerShellVirtualDirectory -BasicAuthentication $true -WindowsAuthentication $true



#to avoid the following error 




# Windows PowerShell
# Copyright (C) Microsoft Corporation. All rights reserved.
#                                                                                                                                                                                                          Install the latest PowerShell for new features and improvements! https://aka.ms/PSWindows                                                                                                                                                                                                                                                                                                                         PS C:\Users\aollivierre> & "C:\Code\Exchange\Exchange2\1013\CB\0-Connect-EX-Onprem.NTI.CB.ps1"                                                                                                                                                                                                                                                                                                                    Pinging NTI-CB-EX01.CB.tunngavik.local [10.5.1.9] with 32 bytes of data:                                                                                                                                 Reply from 10.5.1.9: bytes=32 time=616ms TTL=126                                                                                                                                                         Reply from 10.5.1.9: bytes=32 time=616ms TTL=126                                                                                                                                                         Reply from 10.5.1.9: bytes=32 time=616ms TTL=126                                                                                                                                                         Reply from 10.5.1.9: bytes=32 time=687ms TTL=126                                                                                                                                                                                                                                                                                                                                                                  Ping statistics for 10.5.1.9:                                                                                                                                                                                Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),                                                                                                                                                 Approximate round trip times in milli-seconds:                                                                                                                                                               Minimum = 616ms, Maximum = 687ms, Average = 633ms                                                                                                                                                    Server:  NTI-OTT-DC01.ott.nti.local                                                                                                                                                                      Address:  10.20.48.11                                                                                                                                                                                                                                                                                                                                                                                             Name:    NTI-CB-EX01.CB.tunngavik.local                                                                                                                                                                  Address:  10.5.1.9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ComputerName     : NTI-CB-EX01.CB.tunngavik.local                                                                                                                                                        RemoteAddress    : 10.5.1.9                                                                                                                                                                              RemotePort       : 5985                                                                                                                                                                                  InterfaceAlias   : Ethernet                                                                                                                                                                              SourceAddress    : 10.20.48.202                                                                                                                                                                          TcpTestSucceeded : True                                                                                                                                                                                                                                                                                                                                                                                           WARNING: Stored credentials are invalid or expired. Please enter new credentials.                                                                                                                                                                                                                                                                                                                                 cmdlet Get-Credential at command pipeline position 1                                                                                                                                                     Supply values for the following parameters:                                                                                                                                                              Credential                                                                                                                                                                                               New-PSSession : [nti-cb-ex01.cb.tunngavik.local] Connecting to remote server nti-cb-ex01.cb.tunngavik.local failed with the following error message : WinRM cannot process the request. The following    error with errorcode 0x80090311 occurred while using Kerberos authentication: We can't sign you in with this credential because your domain isn't available. Make sure your device is connected to your  organization's network and try again. If you previously signed in on this device with another credential, you can sign in with that credential.                                                           Possible causes are:                                                                                                                                                                                      -The user name or password specified are invalid.                                                                                                                                                        -Kerberos is used when no authentication method and no user name are specified.                                                                                                                          -Kerberos accepts domain user names, but not local user names.                                                                                                                                           -The Service Principal Name (SPN) for the remote computer name and port does not exist.                                                                                                                  -The client and remote computers are in different domains and there is no trust between the two domains.                                                                                                After checking for the above issues, try the following:                                                                                                                                                   -Check the Event Viewer for events related to authentication.                                                                                                                                            -Change the authentication method; add the destination computer to the WinRM TrustedHosts configuration setting or use HTTPS transport.                                                                                                                                                                                                                                                                          Test-NetConnection - 10.5.1.9:5985                                                                                                                                                                       Note that computers in the TrustedHosts list might not be authenticated.                                                                                                                                   -For more information about WinRM configuration, run the following command: winrm help config. For more information, see the about_Remote_Troubleshooting Help topic.                                 At C:\Code\Exchange\Exchange2\1013\CB\0-Connect-EX-Onprem.NTI.CB.ps1:43 char:12                                                                                                                          + $Session = New-PSSession -ConfigurationName Microsoft.Exchange -Conne ...                                                                                                                              +            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                                                                                                                                      + CategoryInfo          : OpenError: (System.Manageme....RemoteRunspace:RemoteRunspace) [New-PSSession], PSRemotingTransportException                                                                At C:\Code\Exchange\Exchange2\1013\CB\0-Connect-EX-Onprem.NTI.CB.ps1:46 char:18                                                                                                                          + Import-PSSession $Session -DisableNameChecking                                                                                                                                                         +                  ~~~~~~~~                                                                                                                                                                                  + CategoryInfo          : InvalidData: (:) [Import-PSSession], ParameterBindingValidationException                                                                                                       + FullyQualifiedErrorId : ParameterArgumentValidationError,Microsoft.PowerShell.Commands.ImportPSSessionCommand                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 PS C:\Users\aollivierre>                                                                                                                                                                                 PS C:\Users\aollivierre>                                                                                                                                                                                 PS C:\Users\aollivierre>                                                                                                                                                                                 PS C:\Users\aollivierre> & "C:\Code\Exchange\Exchange2\1013\CB\0-Connect-EX-Onprem.NTI.CB copy 3.ps1"                                                                                                    Testing connectivity...                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ComputerName     : NTI-CB-EX01.CB.tunngavik.local                                                                                                                                                        RemoteAddress    : 10.5.1.9                                                                                                                                                                              RemotePort       : 5985                                                                                                                                                                                  InterfaceAlias   : Ethernet                                                                                                                                                                              SourceAddress    : 10.20.48.202                                                                                                                                                                          TcpTestSucceeded : True                                                                                                                                                                                                                                                                                                                                                                                           Configuring WinRM...                                                                                                                                                                                     WinRM service is already running on this machine.                                                                                                                                                        WinRM is already set up for remote management on this computer.                                                                                                                                          Please enter domain credentials in the format 'domain\username'

# cmdlet Get-Credential at command pipeline position 1
# Supply values for the following parameters:
# Credential
# Attempting connection with URI: http://NTI-CB-EX01.CB.tunngavik.local/PowerShell/ and Authentication: Basic
# WARNING: Your connection has been redirected to the following URI: "http://nti-cb-ex01.cb.tunngavik.local/PowerShell-LiveID?PSVersion=5.1.20348.2849"
# Connection attempt failed: Connecting to remote server nti-cb-ex01.cb.tunngavik.local failed with the following error message : The WinRM client received an HTTP status code of 403 from the remote WS-Management service. For more information, see the about_Remote_Troubleshooting Help topic.
# Attempting connection with URI: http://NTI-CB-EX01.CB.tunngavik.local/PowerShell-LiveID and Authentication: Basic
# Connection attempt failed: Connecting to remote server nti-cb-ex01.cb.tunngavik.local failed with the following error message : The WinRM client received an HTTP status code of 403 from the remote WS-Management service. For more information, see the about_Remote_Troubleshooting Help topic.
# Attempting connection with URI: http://NTI-CB-EX01.CB.tunngavik.local/PowerShell/ and Authentication: Negotiate
# Connection attempt failed: Connecting to remote server nti-cb-ex01.cb.tunngavik.local failed with the following error message : The WinRM client cannot process the request. It cannot determine the content type of the HTTP response from the destination computer. The content type is absent or invalid. For more information, see the about_Remote_Troubleshooting Help topic.
# Attempting connection with URI: http:///PowerShell/ and Authentication: Basic
# Connection attempt failed: Cannot bind parameter 'ConnectionUri'. Cannot convert value "http:///PowerShell/" to type "System.Uri". Error: "Invalid URI: The hostname could not be parsed."
# All connection attempts failed. Please check:
# 1. Your credentials (use domain\username format)
# 2. The Exchange Management Tools are installed
# 3. The WinRM service is running on both machines
# 4. Any firewall rules that might be blocking the connection
# 5. The Exchange server's PowerShell virtual directory settings
